## redux-saga

### ä»‹ç»ï¼š
  åœ¨ redux-saga çš„ä¸–ç•Œé‡Œï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½é€šç”¨ yield Effects æ¥å®Œæˆï¼ˆEffect å¯ä»¥çœ‹ä½œæ˜¯ redux-saga çš„ä»»åŠ¡å•å…ƒï¼‰

----
### åè¯é‡Šä¹‰ï¼š
#### Effectï¼š
ä¸€ä¸ª effect å°±æ˜¯ä¸€ä¸ª Plain Object JavaScript å¯¹è±¡ï¼ŒåŒ…å«ä¸€äº›å°†è¢« saga middleware æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ä½¿ç”¨ redux-saga æä¾›çš„å·¥åŽ‚å‡½æ•°æ¥åˆ›å»º effectã€‚ä¸€ä¸ª Saga æ‰€åšçš„å®žé™…ä¸Šæ˜¯ç»„åˆé‚£äº›æ‰€æœ‰çš„ Effectï¼Œå…±åŒå®žçŽ°æ‰€éœ€çš„æŽ§åˆ¶æµã€‚ æœ€ç®€å•çš„ä¾‹å­æ˜¯ç›´æŽ¥æŠŠ yield ä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°æ”¾ç½®æ¥å¯¹åºåˆ—åŒ– yield Effectã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„æŽ§åˆ¶æµæ“ä½œç¬¦ï¼ˆif, while, forï¼‰ æ¥å®žçŽ°æ›´å¤æ‚çš„æŽ§åˆ¶æµã€‚

----
### æ ¸å¿ƒAPI:
- Saga è¾…åŠ©å‡½æ•°:
  - takeEvery
    - å…è®¸å¤šä¸ªå®žä¾‹åŒæ—¶å¯åŠ¨
  - takeLatest
    - åœ¨ä»»ä½•æ—¶åˆ» takeLatest åªå…è®¸æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªä»»åŠ¡æ˜¯æœ€åŽè¢«å¯åŠ¨çš„é‚£ä¸ªï¼Œå¦‚æžœä¹‹å‰å·²ç»æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œé‚£ä¹‹å‰çš„è¿™ä¸ªä»»åŠ¡ä¼šè‡ªåŠ¨è¢«å–æ¶ˆ
- Effect Creators
  - take(pattern)
    - takeå‡½æ•°å¯ä»¥ç†è§£ä¸ºç›‘å¬æœªæ¥çš„actionï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œå‘Šè¯‰middlewareç­‰å¾…ä¸€ä¸ªç‰¹å®šçš„actionï¼Œ Generatorä¼šæš‚åœï¼Œç›´åˆ°ä¸€ä¸ªä¸ŽpatternåŒ¹é…çš„actionè¢«å‘èµ·ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œtakeæ˜¯ä¸€ä¸ªé˜»å¡žçš„ effectã€‚take è®©æˆ‘ä»¬é€šè¿‡å…¨é¢æŽ§åˆ¶ action è§‚å¯Ÿè¿›ç¨‹æ¥æž„å»ºå¤æ‚çš„æŽ§åˆ¶æµæˆä¸ºå¯èƒ½ã€‚
  - put(action)
    - putå‡½æ•°æ˜¯ç”¨æ¥å‘é€actionçš„ effectï¼Œä½ å¯ä»¥ç®€å•çš„æŠŠå®ƒç†è§£æˆä¸ºreduxæ¡†æž¶ä¸­çš„dispatchå‡½æ•°ï¼Œå½“putä¸€ä¸ªactionåŽï¼Œreducerä¸­å°±ä¼šè®¡ç®—æ–°çš„stateå¹¶è¿”å›žï¼Œæ³¨æ„ï¼š put ä¹Ÿæ˜¯é˜»å¡ž effect
  - call(fn, â€¦args)
    - callå‡½æ•°ä½ å¯ä»¥æŠŠå®ƒç®€å•çš„ç†è§£ä¸ºå°±æ˜¯å¯ä»¥è°ƒç”¨å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œå®ƒå‘½ä»¤ middleware æ¥è°ƒç”¨fn å‡½æ•°ï¼Œ argsä¸ºå‡½æ•°çš„å‚æ•°ï¼Œæ³¨æ„ï¼š fn å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ª Generator å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å›ž Promise çš„æ™®é€šå‡½æ•°ï¼Œcall å‡½æ•°ä¹Ÿæ˜¯é˜»å¡ž effect
  - select(selector, â€¦args)
    - select å‡½æ•°æ˜¯ç”¨æ¥æŒ‡ç¤º middlewareè°ƒç”¨æä¾›çš„é€‰æ‹©å™¨èŽ·å–Storeä¸Šçš„stateæ•°æ®ï¼Œä½ ä¹Ÿå¯ä»¥ç®€å•çš„æŠŠå®ƒç†è§£ä¸ºreduxæ¡†æž¶ä¸­èŽ·å–storeä¸Šçš„ stateæ•°æ®ä¸€æ ·çš„åŠŸèƒ½ ï¼šstore.getState()
  - fork(fn, â€¦args)
    - fork å‡½æ•°å’Œ call å‡½æ•°å¾ˆåƒï¼Œéƒ½æ˜¯ç”¨æ¥è°ƒç”¨å…¶ä»–å‡½æ•°çš„ï¼Œä½†æ˜¯forkå‡½æ•°æ˜¯éžé˜»å¡žå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºæ‰§è¡Œå®Œ yield fork(fnï¼Œ args) è¿™ä¸€è¡Œä»£ç åŽï¼Œä¼šç«‹å³æŽ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç è¯­å¥ï¼Œè€Œä¸ä¼šç­‰å¾…fnå‡½æ•°è¿”å›žç»“æžœåŽï¼Œåœ¨æ‰§è¡Œä¸‹é¢çš„è¯­å¥
  - cancel(task)
    - ä¸€æ—¦ä»»åŠ¡è¢« forkï¼Œå¯ä»¥ä½¿ç”¨ yield cancel(task) æ¥ä¸­æ­¢ä»»åŠ¡æ‰§è¡Œï¼Œä½¿ç”¨ yield cancelled() æ¥æ£€æŸ¥ Generator æ˜¯å¦å·²ç»è¢«å–æ¶ˆã€‚å–æ¶ˆæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚å–æ¶ˆæŽ¥å£è¯·æ±‚ï¼ˆraceä¹Ÿå¯ä»¥å®žçŽ°ç±»ä¼¼å–æ¶ˆåŠŸèƒ½ï¼‰
- createSagaMiddleware()
  - createSagaMiddleware å‡½æ•°æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ª Redux ä¸­é—´ä»¶ï¼Œå°† Sagas ä¸Ž Redux Store é“¾æŽ¥èµ·æ¥ã€‚sagas ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½å¿…é¡»è¿”å›žä¸€ä¸ª Generator å¯¹è±¡ï¼Œmiddleware ä¼šè¿­ä»£è¿™ä¸ª Generator å¹¶æ‰§è¡Œæ‰€æœ‰ yield åŽçš„ Effectï¼ˆEffect å¯ä»¥çœ‹ä½œæ˜¯ redux-saga çš„ä»»åŠ¡å•å…ƒï¼‰
- middleware.run(sagas, â€¦args)
  - åŠ¨æ€æ‰§è¡Œsagasï¼Œç”¨äºŽapplyMiddlewareé˜¶æ®µä¹‹åŽæ‰§è¡Œsagas

----
### é”™è¯¯å¤„ç†ï¼š
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ try/catch è¯­æ³•åœ¨ Saga ä¸­æ•èŽ·é”™è¯¯ã€‚

----
#### åŸºæœ¬ä½¿ç”¨

```js
//saga.js
import { takeEvery } from 'redux-saga/effects'
import { ADD_TODO } from './actionType';

//generatorå‡½æ•°
function* mySaga() {
	//ç­‰å¾…æ•èŽ·action
	yield takeEvery(ADD_TODO, getList)
}

function* getList() {
	console.log('jspang')
}

export default mySaga;
```

```js
//index.js
import { createStore, applyMiddleware, compose } from 'redux'
import createSageMiddleware from 'redux-saga'
import { combineReducers } from 'redux'
import * as reducers from './reducers'
import mySaga from './saga'

const sageMiddleware = createSageMiddleware()
const initialState = {
	visibilityFilter: VisibilityFilters.SHOW_ALL,
	todos: []
};
const todoApp = combineReducers(reducers)
let store = createStore(todoApp, initialState, applyMiddleware(sageMiddleware));
sageMiddleware.run(mySaga)
store.subscribe(() =>
	console.log(store.getState())
);

export default store;
```



### ç¤ºä¾‹é¡¹ç›®:

* ðŸ’¯[tiger-react-cli](https://github.com/TigerHee/tiger-react-cli)